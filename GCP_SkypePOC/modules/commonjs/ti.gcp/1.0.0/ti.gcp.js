var GCP=exports||{};GCP.open=open;GCP.close=close;var win=null,container=null,web=null,progressContainer=null,progress=null,isFirstLoad=!0,isAlreadyLoading=!1,loadingEstimates=JSON.parse(Ti.App.Properties.getString("GCP-LoadingEstimates","{}")),currentLoadingEstimateID,loadingStartMS,loadingIntervalID=0,printOptions;
function open(a){if(a){printOptions=a;win=Ti.UI.createWindow({backgroundColor:"transparent"});Ti.Android||(win.opacity=0,win.transform=Ti.UI.create2DMatrix().scale(0));container=Ti.UI.createView({bottom:30,backgroundColor:"#777",zIndex:-1});var b=Ti.UI.createButton({font:{fontSize:11,fontWeight:"bold"},backgroundColor:"#777",borderColor:"#777",color:"#fff",style:0,title:a.closeTitle||"Return to App",right:0,bottom:0,left:0,height:30});b.addEventListener("click",close);win.open();a=0;Ti.Android&&(a=
"10dp");progressContainer=Ti.UI.createView({top:a,right:a,bottom:a,left:a,backgroundColor:"#fff"});progress=Ti.UI.createProgressBar({top:10,right:10,bottom:10,left:10,min:0,max:1,value:0.5,message:"Loading, please wait.",backgroundColor:"#fff",font:{fontSize:14,fontWeight:"bold"},style:0});container.add(progressContainer);progressContainer.add(progress);progress.show();win.add(container);win.add(b);if(!Ti.Android){var b=Ti.UI.createAnimation({transform:Ti.UI.create2DMatrix().scale(1.1),opacity:1,
duration:350}),c=Ti.UI.createAnimation({transform:Ti.UI.create2DMatrix(),duration:400});b.addEventListener("complete",function(){win.animate(c)});win.animate(b)}onBeforeLoad();web=Ti.UI.createWebView({url:"https://www.google.com/cloudprint/dialog.html",top:a,right:a,bottom:a,left:a});web.addEventListener("load",onLoad);web.addEventListener("beforeload",onBeforeLoad);container.add(web)}else alert("Please provide print options!")}
function close(){if(null!=win)try{web.removeEventListener("load",onLoad),web.removeEventListener("beforeload",onBeforeLoad),progress.hide(),win.close(),progress=web=isAlreadyLoading=null,isAlreadyLoading=!1,isFirstLoad=!0,win=container=null}catch(a){Ti.API.error("Cannot close the dialog. Ignoring. "+a)}}var haveInjectedJob=!1;
function onLoad(a){if(!haveInjectedJob){var b=printOptions.title||"New Print Job",c=printOptions.type||"url",e=""+(printOptions.data||""),d="undefined";printOptions.encoding&&(d='"'+printOptions.encoding+'"');a.source.evalJS('window.addEventListener("message", function(evt){ alert(evt); }, false)');a.source.evalJS('printDialog.setPrintDocument(printDialog.createPrintDocument(            "'+c+'",            "'+b+'",            "'+e.split("\r\n").join("|^|")+'".split("|^|").join("\\r\\n"),            '+
d+")        )");haveInjectedJob=!0}progress&&progress.hide();progressContainer&&progressContainer.hide();web&&web.show();isAlreadyLoading=!1;clearInterval(loadingIntervalID);loadingEstimates[currentLoadingEstimateID]=(new Date).getTime()-loadingStartMS;Ti.App.Properties.setString("Social-LoadingEstimates",JSON.stringify(loadingEstimates))}
function onBeforeLoad(){isAlreadyLoading||(isAlreadyLoading=!0,progress.value=0,currentLoadingEstimateID="pageLoad",loadingEstimates[currentLoadingEstimateID]||(loadingEstimates[currentLoadingEstimateID]=isFirstLoad?2E3:1E3),isFirstLoad=!1,loadingStartMS=(new Date).getTime(),loadingIntervalID=setInterval(updateProgress,30),web&&web.hide(),progress&&progress.show(),progressContainer&&progressContainer.show())}
function updateProgress(){progress&&(progress.value=((new Date).getTime()-loadingStartMS)/loadingEstimates[currentLoadingEstimateID])};